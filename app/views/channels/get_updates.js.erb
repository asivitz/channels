var donotify = false;

<% @new_message_groups.each do |group| %>

    if (topPoster() == '<%= group.poster %>')
    {
        <% group.messages.each do |m| %>
            //see if we already have this message
            var existing = $('#message_<%= m.id %>');
            if (existing.length == 0)
            {
                var msg = $("<%= escape_javascript(render :partial => "channels/message", :object => m) %>");
                var ul = getLatestContainer().find('.message_content');
                msg.appendTo(ul);
                msg.hide().fadeIn();
                donotify = true;
            }
        <% end %>
    }
    else
    {
        var msggroup = $("<%= escape_javascript(render :partial => "channels/message_group", :object => group) %>");

        msggroup.appendTo($('#message_list'));
        msggroup.hide().fadeIn();
        donotify = true;
    }

    messageScrollBottom();

<% end %>

last_checked = '<%= Time.now.to_i %>';

if (weHaveFocus)
{
	fadeUnread();
}
else
{
    if (donotify == true)
    {
        startNotify('<%= @new_message_groups.first.poster %>');
    }
}
